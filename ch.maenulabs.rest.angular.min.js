/**
 * ch.maenulabs.rest.angular v0.12.0
 * built on 17.01.2016
 * Copyright 2016 Manuel Leuenberger
 * licenced under MIT, see LICENSE.txt
 */
angular.module("ch.maenulabs.rest.angular.eventify",[]),angular.module("ch.maenulabs.rest.angular",[]),angular.module("ch.maenulabs.rest.angular.pattern",["ch.maenulabs.rest.angular.eventify"]),angular.module("ch.maenulabs.rest.angular.router",["ngRoute","ch.maenulabs.rest.angular"]),angular.module("ch.maenulabs.rest.angular").factory("ch.maenulabs.rest.angular.Resource",["$http",function(a){var b=ch.maenulabs.validation.Validation;return new ch.maenulabs.type.Type(Object,{initialize:function(a){angular.extend(this,a||{}),this.links=this.links||[],this.validation=this.validation||new b},hasErrors:function(){return this.validation.hasErrors(this)},getErrors:function(){return this.validation.getErrors(this)},hasError:function(a){return this.getError(a).length>0},getError:function(a){for(var b=[this.getErrors()],c=a.split(".");c.length>0;){var d=c.shift();b=b.filter(function(a){return a[d]}).reduce(function(a,b){return a.concat(b[d])},[])}return b},getLink:function(a){return this.links.filter(function(b){return b.rel.indexOf(a)>-1})[0].href},create:function(){return a({url:this.getLink("self"),method:"POST",data:this.serialize()}).then(function(a){return this.deserialize(a.data),a}.bind(this))},read:function(){return a({url:this.getLink("self"),method:"GET"}).then(function(a){return this.deserialize(a.data),a}.bind(this))},update:function(){return a({url:this.getLink("self"),method:"PUT",data:this.serialize()})},"delete":function(){return a({url:this.getLink("self"),method:"DELETE"}).then(function(a){return this.links=[],a}.bind(this))},serialize:function(){return angular.toJson(this.simplify())},deserialize:function(a){this.desimplify(angular.fromJson(a))},simplify:function(){var a={};return a.links=this.links,a},desimplify:function(a){this.links=a.links}},{deserialize:function(a){var b=new this;return b.deserialize(a),b},desimplify:function(a){var b=new this;return b.desimplify(a),b}})}]),angular.module("ch.maenulabs.rest.angular").factory("ch.maenulabs.rest.angular.ResourceCollection",["ch.maenulabs.rest.angular.Resource",function(a){var b=ch.maenulabs.validation.ExistenceCheck,c=ch.maenulabs.validation.PropertiesCheck;return new ch.maenulabs.type.Type(a,{initialize:function(a){this.base("initialize")(a),this.resources=this.resources||[],this.validation.add(new b("resources")),this.validation.add(new c(["resources"],function(a){return a?!a.some(function(a){return a.hasErrors()}):!0},function(a){return a.map(function(a,b){return a.getErrors()})}))},simplify:function(){var a=this.base("simplify")();return a.resources=this.resources.map(function(a){return a.simplify()}),a},desimplify:function(a){this.base("desimplify")(a),this.resources=a.resources.map(function(a){return this.resourceType.desimplify(a)}.bind(this))}})}]),angular.module("ch.maenulabs.rest.angular.eventify").factory("ch.maenulabs.rest.angular.eventify.action",["$q",function(a){return function(b,c,d){return function(){var e=a.defer();return b.$emit("ch.maenulabs.rest.angular.eventify.action.Pending",d,b[c]),b[c][d].apply(c,arguments).then(function(a){b.$emit("ch.maenulabs.rest.angular.eventify.action.Resolved",d,b[c],a),e.resolve(a)},function(a){b.$emit("ch.maenulabs.rest.angular.eventify.action.Rejected",d,b[c],a),e.reject(a)},function(a){b.$emit("ch.maenulabs.rest.angular.eventify.action.Notified",d,b[c],a),e.notify(a)}),e.promise}}}]),angular.module("ch.maenulabs.rest.angular.eventify").factory("ch.maenulabs.rest.angular.eventify.change",function(){return function(a,b,c){return c=c.map(function(a){return b+"."+a}),a.$watchGroup(c,function(){a.$emit("ch.maenulabs.rest.angular.eventify.change.Changed",a[b])})}}),angular.module("ch.maenulabs.rest.angular.eventify").factory("ch.maenulabs.rest.angular.eventify.validation",function(){return function(a,b){return a.$watch(b+".hasErrors()",function(c){c?a.$emit("ch.maenulabs.rest.angular.eventify.validation.Error",a[b]):a.$emit("ch.maenulabs.rest.angular.eventify.validation.Success",a[b])})}}),angular.module("ch.maenulabs.rest.angular.pattern").factory("ch.maenulabs.rest.angular.pattern.create",["ch.maenulabs.rest.angular.eventify.action","ch.maenulabs.rest.angular.eventify.validation",function(a,b){return function(c,d){return b(c,d),a(c,d,"create")}}]),angular.module("ch.maenulabs.rest.angular.pattern").factory("ch.maenulabs.rest.angular.pattern.delete",["ch.maenulabs.rest.angular.eventify.action",function(a){return function(b,c){return a(b,c,"delete")}}]),angular.module("ch.maenulabs.rest.angular.pattern").factory("ch.maenulabs.rest.angular.pattern.read",["ch.maenulabs.rest.angular.eventify.action",function(a){return function(b,c){return a(b,c,"read")}}]),angular.module("ch.maenulabs.rest.angular.pattern").factory("ch.maenulabs.rest.angular.pattern.update",["ch.maenulabs.rest.angular.eventify.action","ch.maenulabs.rest.angular.eventify.validation","ch.maenulabs.rest.angular.eventify.change",function(a,b,c){return function(d,e){return c(d,e),b(d,e),a(d,e,"update")}}]),angular.module("ch.maenulabs.rest.angular.router").provider("ch.maenulabs.rest.angular.router.router",["$routeProvider",function(a){var b="serialization",c=":"+b+"*",d={},e=function(a,b){return"/"+a+"/"+b},f=function(a,b){var f=e(a,b);d[f]=f+"/"+c},g=function(a,b){var c=e(a,b);return d[c]};this.addRoute=function(c,d,h,i){i.resolve||(i.resolve={}),i.resolve.resource=["$route",h,function(a,c){var d=a.current.params[b];return d||(d="{}"),c.deserialize(d)}],f(c,d),a.when(e(c,d),i),a.when(g(c,d),i)},this.$get=function(){return{getUri:function(a,b,d){return g(a,b).replace(c,d.serialize())}}}}]);