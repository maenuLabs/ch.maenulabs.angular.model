/**
 * ch.maenulabs.rest.angular v0.10.0
 * built on 27.12.2015
 * Copyright 2015 Manuel Leuenberger
 * licenced under MIT, see LICENSE.txt
 */
angular.module("ch.maenulabs.rest.angular.controller.decorator",["ch.maenulabs.rest.angular.controller"]),angular.module("ch.maenulabs.rest.angular.controller",["ch.maenulabs.rest.angular.event"]),angular.module("ch.maenulabs.rest.angular.event",["ch.maenulabs.rest.angular.resource"]),angular.module("ch.maenulabs.rest.angular",[]),angular.module("ch.maenulabs.rest.angular.resource",[]),angular.module("ch.maenulabs.rest.angular.router",["ngRoute","ch.maenulabs.rest.angular.resource"]),angular.module("ch.maenulabs.rest.angular.controller").controller("ch.maenulabs.rest.angular.controller.Create",["$scope","ch.maenulabs.rest.angular.event.eventifyAction","ch.maenulabs.rest.angular.event.eventifyValidation","resource",function(a,b,c,d){this.resource=d,c(a,this.resource),this.create=b(a,this.resource,"create")}]),angular.module("ch.maenulabs.rest.angular.controller").controller("ch.maenulabs.rest.angular.controller.Delete",["$scope","ch.maenulabs.rest.angular.event.eventifyAction","resource",function(a,b,c){this.resource=c,this["delete"]=b(a,this.resource,"delete")}]),angular.module("ch.maenulabs.rest.angular.controller").controller("ch.maenulabs.rest.angular.controller.Read",["$scope","ch.maenulabs.rest.angular.event.eventifyAction","resource",function(a,b,c){this.resource=c,this.read=b(a,this.resource,"read")}]),angular.module("ch.maenulabs.rest.angular.controller").controller("ch.maenulabs.rest.angular.controller.Search",["$scope","ch.maenulabs.rest.angular.event.eventifyAction","ch.maenulabs.rest.angular.event.eventifyChange","ch.maenulabs.rest.angular.event.eventifySchedule","resource","delay",function(a,b,c,d,e,f){this.cancel=function(){},this.resource=e,this.search=b(a,this.resource,"search"),a.$on("ch.maenulabs.rest.angular.resource.Changed",function(b,c){c==this.resource&&(this.cancel(),this.cancel=d(a,f))}.bind(this)),a.$on("ch.maenulabs.rest.angular.event.schedule.Done",function(a,b){b==this.cancel&&(this.cancel=function(){},this.search())}.bind(this)),c(a,this.resource)}]),angular.module("ch.maenulabs.rest.angular.controller").controller("ch.maenulabs.rest.angular.controller.Update",["$scope","ch.maenulabs.rest.angular.event.eventifyAction","ch.maenulabs.rest.angular.event.eventifyValidation","ch.maenulabs.rest.angular.event.eventifyChange","resource",function(a,b,c,d,e){this.resource=e,d(a,this.resource),c(a,this.resource),this.update=b(a,this.resource,"update")}]),angular.module("ch.maenulabs.rest.angular.controller.decorator").decorator("$controller",["$parse","$delegate",function(a,b){var c=/^([^\(\s]+)(\(([^\)]*)\))?(\s+as\s+(\w+))?$/,d=angular.$$minErr("ch.maenulabs.rest.angular.controller.decorator.$controller");return function(e,f,g,h){var i=e.match(c);if(!i)throw d("ctrlfmt","Badly formed controller string '{0}'. Must match `__name__ as __id__` or `__name__` or `__name__(__expression__) as __id__` or `__name__(__expression__)`.",e);var j=i[1];return i[3]&&(f.resource=a(i[3])(f.$scope)),i[5]&&!h&&(h=i[5]),b.apply(this,[j,f,g,h])}}]),angular.module("ch.maenulabs.rest.angular.event").factory("ch.maenulabs.rest.angular.event.eventifyAction",function(){return function(a,b,c){return function(){return a.$emit("ch.maenulabs.rest.angular.resource."+c+".Pending",b),b[c].apply(b,arguments).then(function(d){return a.$emit("ch.maenulabs.rest.angular.resource."+c+".Success",b,d),d})["catch"](function(d){return a.$emit("ch.maenulabs.rest.angular.resource."+c+".Error",b,d),d})}}}),angular.module("ch.maenulabs.rest.angular.event").factory("ch.maenulabs.rest.angular.event.eventifyChange",function(){return function(a,b){return a.$watchGroup(b.getChangeables(),function(){a.$emit("ch.maenulabs.rest.angular.resource.Changed",b)})}}),angular.module("ch.maenulabs.rest.angular.event").factory("ch.maenulabs.rest.angular.event.eventifySchedule",["$timeout",function(a){return function(b,c){var d=a(angular.noop,c),e=function(){return a.cancel(d)};return b.$emit("ch.maenulabs.rest.angular.event.schedule.Scheduled",e),d.then(function(a){return b.$emit("ch.maenulabs.rest.angular.event.schedule.Done",e),a})["catch"](function(a){return b.$emit("ch.maenulabs.rest.angular.event.schedule.Cancelled",e),a}),e}}]),angular.module("ch.maenulabs.rest.angular.event").factory("ch.maenulabs.rest.angular.event.eventifyValidation",function(){return function(a,b){return a.$watch(function(){return b.hasErrors()},function(c){c?a.$emit("ch.maenulabs.rest.angular.resource.validation.Error",b):a.$emit("ch.maenulabs.rest.angular.resource.validation.Success",b)})}}),angular.module("ch.maenulabs.rest.angular.resource").factory("ch.maenulabs.rest.angular.resource.AbstractResource",["$http",function(a){var b=function(a){var c={};for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];if(e instanceof Object){e=b(e);for(var f in e)e.hasOwnProperty(f)&&(c[d+"."+f]=e[f])}else c[d]=e}return c},c=ch.maenulabs.validation.Validation;return new ch.maenulabs.type.Type(Object,{initialize:function(a){angular.extend(this,a||{}),this.validation=this.validation||new c},hasErrors:function(){return this.validation.hasErrors(this)},getErrors:function(){return this.validation.getErrors(this)},hasError:function(a){var b=this.validation.getErrors(this);return b[a]&&b[a].length>0},getError:function(a){return this.validation.getErrors(this)[a]||[]},getChangeables:function(){throw new Error("not implemented")},create:function(){return a({url:this.getBaseUri(),method:"POST",data:this.serialize()}).then(function(a){return this.uri=a.headers("location"),a}.bind(this))},read:function(){return a({url:this.uri,method:"GET"}).then(function(a){return this.deserialize(a.data),a}.bind(this))},update:function(){return a({url:this.uri,method:"PUT",data:this.serialize()})},"delete":function(){return a({url:this.uri,method:"DELETE"}).then(function(a){return this.uri=null,a}.bind(this))},search:function(){return a({url:this.getSearchUri(),method:"GET"}).then(function(a){var b=angular.fromJson(a.data);a.results=[];for(var c=0;c<b.length;c+=1)a.results.push(this.type.desimplify(b[c]));return a}.bind(this))},serialize:function(){return angular.toJson(this.simplify())},deserialize:function(a){this.desimplify(angular.fromJson(a))},simplify:function(){return{uri:this.uri}},desimplify:function(a){this.uri=a.uri},getBaseName:function(){throw new Error("not implemented")},getBaseUri:function(){throw new Error("not implemented")},getSearchUri:function(){return this.getBaseUri()+"?"+this.toSearchParameters()},toSearchParameters:function(){var a=[],c=b(this.simplify());for(var d in c){var e=c[d];if(null!=e){var f=encodeURIComponent(d)+"="+encodeURIComponent(e);a.push(f)}}return a.join("&")}},{deserialize:function(a){var b=new this;return b.deserialize(a),b},desimplify:function(a){var b=new this;return b.desimplify(a),b}})}]),angular.module("ch.maenulabs.rest.angular.router").provider("ch.maenulabs.rest.angular.router.router",["$routeProvider",function(a){var b="serialization",c=":"+b+"*",d={},e=function(a,b){return a+"/"+b},f=function(a,b){d[e(a,b)]="/"+a+"/"+b+"/"+c},g=function(a,b){return d[e(a,b)]};this.addRoute=function(c,d,e,h){h.resolve||(h.resolve={}),h.resolve.resource=["$route",d,function(a,c){var d=a.current.params[b];d||(d={});var e=c.deserialize(d);return e.uri?e.read().then(function(){return e}):e}],f(c,e),a.when(g(c,e),h)},this.$get=function(){return{getUri:function(a,b){return g(a.getBaseName(),b).replace(c,a.serialize())}}}}]);