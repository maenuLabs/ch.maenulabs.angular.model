/**
 * ch.maenulabs.rest.angular v0.7.0
 * built on 28.10.2015
 * Copyright 2015 Manuel Leuenberger
 * licenced under MIT, see LICENSE.txt
 */
angular.module("ch.maenulabs.rest.angular.controller",["ch.maenulabs.rest.angular.service"]),angular.module("ch.maenulabs.rest.angular",[]),angular.module("ch.maenulabs.rest.angular.resource",[]),angular.module("ch.maenulabs.rest.angular.service",["ch.maenulabs.rest.angular.resource"]),angular.module("ch.maenulabs.rest.angular.controller").factory("ch.maenulabs.rest.angular.controller.CreateFactory",["ch.maenulabs.rest.angular.service.eventifyAction","ch.maenulabs.rest.angular.service.eventifyValidation",function(a,b){return["$scope","resource",function(c,d){b(c,d),this.create=a(c,d,"create")}]}]),angular.module("ch.maenulabs.rest.angular.controller").factory("ch.maenulabs.rest.angular.controller.DeleteFactory",["ch.maenulabs.rest.angular.service.eventifyAction",function(a){return["$scope","resource",function(b,c){this["delete"]=a(b,c,"delete")}]}]),angular.module("ch.maenulabs.rest.angular.controller").factory("ch.maenulabs.rest.angular.controller.ReadFactory",["ch.maenulabs.rest.angular.service.eventifyAction",function(a){return["$scope","resource",function(b,c){this.read=a(b,c,"read")}]}]),angular.module("ch.maenulabs.rest.angular.controller").factory("ch.maenulabs.rest.angular.controller.SearchFactory",["ch.maenulabs.rest.angular.service.eventifyAction","ch.maenulabs.rest.angular.service.eventifyChange","ch.maenulabs.rest.angular.service.eventifySchedule",function(a,b,c){return["$scope","resource","delay",function(d,e,f){var g=angular.noop;this.search=a(d,e,"search"),d.$on("ch.maenulabs.rest.angular.resource.Changed",function(){g(),g=c(d,f)}),d.$on("ch.maenulabs.rest.angular.service.schedule.Done",angular.bind(this,function(){g=angular.noop,this.search()})),b(d,e)}]}]),angular.module("ch.maenulabs.rest.angular.controller").factory("ch.maenulabs.rest.angular.controller.UpdateFactory",["ch.maenulabs.rest.angular.service.eventifyAction","ch.maenulabs.rest.angular.service.eventifyValidation","ch.maenulabs.rest.angular.service.eventifyChange",function(a,b,c){return["$scope","resource",function(d,e){c(d,e),b(d,e),this.update=a(d,e,"update")}]}]),angular.module("ch.maenulabs.rest.angular.resource").factory("ch.maenulabs.rest.angular.resource.AbstractResource",["$http",function(a){var b=function(a){var c={};for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];if(e instanceof Object){e=b(e);for(var f in e)e.hasOwnProperty(f)&&(c[d+"."+f]=e[f])}else c[d]=e}return c},c=ch.maenulabs.validation.Validation;return new ch.maenulabs.type.Type(Object,{initialize:function(a){angular.extend(this,a||{}),this.validation=this.validation||new c},hasErrors:function(){return this.validation.hasErrors(this)},getErrors:function(){return this.validation.getErrors(this)},hasError:function(a){var b=this.validation.getErrors(this);return b[a]&&b[a].length>0},getError:function(a){return this.validation.getErrors(this)[a]||[]},getChangeables:function(){throw new Error("not implemented")},create:function(){return a({url:this.getBaseUri(),method:"POST",data:this.serialize()}).then(angular.bind(this,function(a){return this.uri=a.headers("location"),a}))},read:function(){return a({url:this.uri,method:"GET"}).then(angular.bind(this,function(a){return this.deserialize(a.data),a}))},update:function(){return a({url:this.uri,method:"PUT",data:this.serialize()})},"delete":function(){return a({url:this.uri,method:"DELETE"}).then(angular.bind(this,function(a){return this.uri=null,a}))},search:function(){var b=a({url:this.getSearchUri(),method:"GET"});return b.then(angular.bind(this,function(a){var b=angular.fromJson(a.data);a.results=[];for(var c=0;c<b.length;c+=1)a.results.push(this.type.desimplify(b[c]));return a}))},serialize:function(){return angular.toJson(this.simplify())},deserialize:function(a){this.desimplify(angular.fromJson(a))},simplify:function(){return{uri:this.uri}},desimplify:function(a){this.uri=a.uri},getBaseUri:function(){throw new Error("not implemented")},getSearchUri:function(){return this.getBaseUri()+"?"+this.toSearchParameters()},toSearchParameters:function(){var a=[],c=b(this.simplify());for(var d in c){var e=c[d];if(null!=e){var f=encodeURIComponent(d)+"="+encodeURIComponent(e);a.push(f)}}return a.join("&")}},{deserialize:function(a){var b=new this;return b.deserialize(a),b},desimplify:function(a){var b=new this;return b.desimplify(a),b}})}]),angular.module("ch.maenulabs.rest.angular.service").factory("ch.maenulabs.rest.angular.service.eventifyAction",function(){return function(a,b,c){return function(){return a.$emit("ch.maenulabs.rest.angular.resource."+c+".Pending",b),b[c]().then(function(d){return a.$emit("ch.maenulabs.rest.angular.resource."+c+".Success",b,d),d})["catch"](function(d){return a.$emit("ch.maenulabs.rest.angular.resource."+c+".Error",b,d),d})}}}),angular.module("ch.maenulabs.rest.angular.service").factory("ch.maenulabs.rest.angular.service.eventifyChange",function(){return function(a,b){return a.$watchGroup(b.getChangeables(),function(){a.$emit("ch.maenulabs.rest.angular.resource.Changed",b)})}}),angular.module("ch.maenulabs.rest.angular.service").factory("ch.maenulabs.rest.angular.service.eventifySchedule",["$timeout",function(a){return function(b,c){var d=a(angular.noop,c),e=function(){return a.cancel(d)};return b.$emit("ch.maenulabs.rest.angular.service.schedule.Scheduled",e),d.then(function(a){return b.$emit("ch.maenulabs.rest.angular.service.schedule.Done",e),a})["catch"](function(a){return b.$emit("ch.maenulabs.rest.angular.service.schedule.Cancelled",e),a}),e}}]),angular.module("ch.maenulabs.rest.angular.service").factory("ch.maenulabs.rest.angular.service.eventifyValidation",function(){return function(a,b){return a.$watch(function(){return b.hasErrors()},function(c){c?a.$emit("ch.maenulabs.rest.angular.resource.validation.Error",b):a.$emit("ch.maenulabs.rest.angular.resource.validation.Success",b)})}});