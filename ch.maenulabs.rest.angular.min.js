/**
 * ch.maenulabs.rest.angular v0.11.0
 * built on 01.01.2016
 * Copyright 2016 Manuel Leuenberger
 * licenced under MIT, see LICENSE.txt
 */
angular.module("ch.maenulabs.rest.angular",[]),angular.module("ch.maenulabs.rest.angular.resource.eventify",[]),angular.module("ch.maenulabs.rest.angular.resource",[]),angular.module("ch.maenulabs.rest.angular.resource.pattern",["ch.maenulabs.rest.angular.resource.eventify"]),angular.module("ch.maenulabs.rest.angular.resource").factory("ch.maenulabs.rest.angular.resource.AbstractResource",["$http",function(a){var b=function(a){var c={};for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];if(e instanceof Object){e=b(e);for(var f in e)e.hasOwnProperty(f)&&(c[d+"."+f]=e[f])}else c[d]=e}return c},c=ch.maenulabs.validation.Validation;return new ch.maenulabs.type.Type(Object,{initialize:function(a){angular.extend(this,a||{}),this.validation=this.validation||new c},hasErrors:function(){return this.validation.hasErrors(this)},getErrors:function(){return this.validation.getErrors(this)},hasError:function(a){var b=this.validation.getErrors(this);return b[a]&&b[a].length>0},getError:function(a){return this.validation.getErrors(this)[a]||[]},getChangeables:function(){throw new Error("not implemented")},create:function(){return a({url:this.getBaseUri(),method:"POST",data:this.serialize()}).then(function(a){return this.uri=a.headers("location"),a}.bind(this))},read:function(){return a({url:this.uri,method:"GET"}).then(function(a){return this.deserialize(a.data),a}.bind(this))},update:function(){return a({url:this.uri,method:"PUT",data:this.serialize()})},"delete":function(){return a({url:this.uri,method:"DELETE"}).then(function(a){return this.uri=null,a}.bind(this))},search:function(){return a({url:this.getSearchUri(),method:"GET"}).then(function(a){var b=angular.fromJson(a.data);a.results=[];for(var c=0;c<b.length;c+=1)a.results.push(this.type.desimplify(b[c]));return a}.bind(this))},serialize:function(){return angular.toJson(this.simplify())},deserialize:function(a){this.desimplify(angular.fromJson(a))},simplify:function(){return{uri:this.uri}},desimplify:function(a){this.uri=a.uri},getBaseName:function(){throw new Error("not implemented")},getBaseUri:function(){throw new Error("not implemented")},getSearchUri:function(){return this.getBaseUri()+"?"+this.toSearchParameters()},toSearchParameters:function(){var a=[],c=b(this.simplify());for(var d in c){var e=c[d];if(null!=e){var f=encodeURIComponent(d)+"="+encodeURIComponent(e);a.push(f)}}return a.join("&")}},{deserialize:function(a){var b=new this;return b.deserialize(a),b},desimplify:function(a){var b=new this;return b.desimplify(a),b}})}]),angular.module("ch.maenulabs.rest.angular.resource.eventify").factory("ch.maenulabs.rest.angular.resource.eventify.action",["$q",function(a){return function(b,c,d){return function(){var e=a.defer();return b.$emit("ch.maenulabs.rest.angular.resource.eventify.action.Pending",d,b[c]),b[c][d].apply(c,arguments).then(function(a){b.$emit("ch.maenulabs.rest.angular.resource.eventify.action.Resolved",d,b[c],a),e.resolve(a)},function(a){b.$emit("ch.maenulabs.rest.angular.resource.eventify.action.Rejected",d,b[c],a),e.reject(a)},function(a){b.$emit("ch.maenulabs.rest.angular.resource.eventify.action.Notified",d,b[c],a),e.notify(a)}),e.promise}}}]),angular.module("ch.maenulabs.rest.angular.resource.eventify").factory("ch.maenulabs.rest.angular.resource.eventify.change",function(){return function(a,b){var c=angular.noop,d=angular.noop,e=function(){c(),d(),c=angular.noop,d=angular.noop};return c=a.$watch(b,function(c,e){c!=e&&d();var f=c.getChangeables().map(function(a){return b+"."+a});d=a.$watchGroup(f,function(){a.$emit("ch.maenulabs.rest.angular.resource.eventify.change.Changed",a[b])})}),e}}),angular.module("ch.maenulabs.rest.angular.resource.eventify").factory("ch.maenulabs.rest.angular.resource.eventify.validation",function(){return function(a,b){return a.$watch(b+".hasErrors()",function(c){c?a.$emit("ch.maenulabs.rest.angular.resource.eventify.validation.Error",a[b]):a.$emit("ch.maenulabs.rest.angular.resource.eventify.validation.Success",a[b])})}}),angular.module("ch.maenulabs.rest.angular.resource.pattern").factory("ch.maenulabs.rest.angular.resource.pattern.create",["ch.maenulabs.rest.angular.resource.eventify.action","ch.maenulabs.rest.angular.resource.eventify.validation",function(a,b){return function(c,d){return b(c,d),a(c,d,"create")}}]),angular.module("ch.maenulabs.rest.angular.resource.pattern").factory("ch.maenulabs.rest.angular.resource.pattern.delete",["ch.maenulabs.rest.angular.resource.eventify.action",function(a){return function(b,c){return a(b,c,"delete")}}]),angular.module("ch.maenulabs.rest.angular.resource.pattern").factory("ch.maenulabs.rest.angular.resource.pattern.read",["ch.maenulabs.rest.angular.resource.eventify.action",function(a){return function(b,c){return a(b,c,"read")}}]),angular.module("ch.maenulabs.rest.angular.resource.pattern").factory("ch.maenulabs.rest.angular.resource.pattern.search",["$timeout","ch.maenulabs.rest.angular.resource.eventify.action","ch.maenulabs.rest.angular.resource.eventify.change",function(a,b,c){return function(d,e,f){return function(){var g=void 0,h=angular.noop,i=angular.noop,j=function(){h(),i(),h=angular.noop,i=angular.noop},k=b(d,e,"search");return h=c(d,e),i=d.$on("ch.maenulabs.rest.angular.resource.eventify.change.Changed",function(b,c){c==d[e]&&(g&&a.cancel(g),g=a(f),g.then(function(){g=void 0,j(),k()}))}),j}}}]),angular.module("ch.maenulabs.rest.angular.resource.pattern").factory("ch.maenulabs.rest.angular.resource.pattern.update",["ch.maenulabs.rest.angular.resource.eventify.action","ch.maenulabs.rest.angular.resource.eventify.validation","ch.maenulabs.rest.angular.resource.eventify.change",function(a,b,c){return function(d,e){return c(d,e),b(d,e),a(d,e,"update")}}]);