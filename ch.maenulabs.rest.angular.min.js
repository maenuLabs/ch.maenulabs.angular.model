/**
 * ch.maenulabs.rest.angular v0.9.0
 * built on 27.12.2015
 * Copyright 2015 Manuel Leuenberger
 * licenced under MIT, see LICENSE.txt
 */
angular.module("ch.maenulabs.rest.angular.controller.decorator",["ch.maenulabs.rest.angular.controller"]),angular.module("ch.maenulabs.rest.angular.controller",["ch.maenulabs.rest.angular.event"]),angular.module("ch.maenulabs.rest.angular.event",["ch.maenulabs.rest.angular.resource"]),angular.module("ch.maenulabs.rest.angular",[]),angular.module("ch.maenulabs.rest.angular.resource",[]),angular.module("ch.maenulabs.rest.angular.router",["ngRoute","ch.maenulabs.rest.angular.resource"]),angular.module("ch.maenulabs.rest.angular.controller").factory("ch.maenulabs.rest.angular.controller.Create",["ch.maenulabs.rest.angular.event.eventifyAction","ch.maenulabs.rest.angular.event.eventifyValidation",function(a,b){return["$scope","resource",function(c,d){this.resource=d,b(c,this.resource),this.create=a(c,this.resource,"create")}]}]),angular.module("ch.maenulabs.rest.angular.controller").factory("ch.maenulabs.rest.angular.controller.Delete",["ch.maenulabs.rest.angular.event.eventifyAction",function(a){return["$scope","resource",function(b,c){this.resource=c,this["delete"]=a(b,this.resource,"delete")}]}]),angular.module("ch.maenulabs.rest.angular.controller").factory("ch.maenulabs.rest.angular.controller.Read",["ch.maenulabs.rest.angular.event.eventifyAction",function(a){return["$scope","resource",function(b,c){this.resource=c,this.read=a(b,this.resource,"read")}]}]),angular.module("ch.maenulabs.rest.angular.controller").factory("ch.maenulabs.rest.angular.controller.Search",["ch.maenulabs.rest.angular.event.eventifyAction","ch.maenulabs.rest.angular.event.eventifyChange","ch.maenulabs.rest.angular.event.eventifySchedule",function(a,b,c){return["$scope","resource","delay",function(d,e,f){this.cancel=function(){},this.resource=e,this.search=a(d,this.resource,"search"),d.$on("ch.maenulabs.rest.angular.resource.Changed",function(a,b){b==this.resource&&(this.cancel(),this.cancel=c(d,f))}.bind(this)),d.$on("ch.maenulabs.rest.angular.event.schedule.Done",function(a,b){b==this.cancel&&(this.cancel=function(){},this.search())}.bind(this)),b(d,this.resource)}]}]),angular.module("ch.maenulabs.rest.angular.controller").factory("ch.maenulabs.rest.angular.controller.Update",["ch.maenulabs.rest.angular.event.eventifyAction","ch.maenulabs.rest.angular.event.eventifyValidation","ch.maenulabs.rest.angular.event.eventifyChange",function(a,b,c){return["$scope","resource",function(d,e){this.resource=e,c(d,this.resource),b(d,this.resource),this.update=a(d,this.resource,"update")}]}]),angular.module("ch.maenulabs.rest.angular.controller.decorator").decorator("$controller",["$injector","$parse","$delegate",function(a,b,c){var d=/^([^\(\s]+)(\(([^\)]*)\))?(\s+as\s+(\w+))?$/;return function(e,f,g,h){try{return c.apply(this,arguments)}catch(i){var j=e.match(d),k=j[1].split("."),l=k[k.length-1],m=a.get("ch.maenulabs.rest.angular.controller."+l);return j[3]&&(f.resource=b(j[3])(f.$scope)),j[5]&&!h&&(h=j[5]),c.apply(this,[m,f,g,h])}}}]),angular.module("ch.maenulabs.rest.angular.event").factory("ch.maenulabs.rest.angular.event.eventifyAction",function(){return function(a,b,c){return function(){return a.$emit("ch.maenulabs.rest.angular.resource."+c+".Pending",b),b[c].apply(b,arguments).then(function(d){return a.$emit("ch.maenulabs.rest.angular.resource."+c+".Success",b,d),d})["catch"](function(d){return a.$emit("ch.maenulabs.rest.angular.resource."+c+".Error",b,d),d})}}}),angular.module("ch.maenulabs.rest.angular.event").factory("ch.maenulabs.rest.angular.event.eventifyChange",function(){return function(a,b){return a.$watchGroup(b.getChangeables(),function(){a.$emit("ch.maenulabs.rest.angular.resource.Changed",b)})}}),angular.module("ch.maenulabs.rest.angular.event").factory("ch.maenulabs.rest.angular.event.eventifySchedule",["$timeout",function(a){return function(b,c){var d=a(angular.noop,c),e=function(){return a.cancel(d)};return b.$emit("ch.maenulabs.rest.angular.event.schedule.Scheduled",e),d.then(function(a){return b.$emit("ch.maenulabs.rest.angular.event.schedule.Done",e),a})["catch"](function(a){return b.$emit("ch.maenulabs.rest.angular.event.schedule.Cancelled",e),a}),e}}]),angular.module("ch.maenulabs.rest.angular.event").factory("ch.maenulabs.rest.angular.event.eventifyValidation",function(){return function(a,b){return a.$watch(function(){return b.hasErrors()},function(c){c?a.$emit("ch.maenulabs.rest.angular.resource.validation.Error",b):a.$emit("ch.maenulabs.rest.angular.resource.validation.Success",b)})}}),angular.module("ch.maenulabs.rest.angular.resource").factory("ch.maenulabs.rest.angular.resource.AbstractResource",["$http",function(a){var b=function(a){var c={};for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];if(e instanceof Object){e=b(e);for(var f in e)e.hasOwnProperty(f)&&(c[d+"."+f]=e[f])}else c[d]=e}return c},c=ch.maenulabs.validation.Validation;return new ch.maenulabs.type.Type(Object,{initialize:function(a){angular.extend(this,a||{}),this.validation=this.validation||new c},hasErrors:function(){return this.validation.hasErrors(this)},getErrors:function(){return this.validation.getErrors(this)},hasError:function(a){var b=this.validation.getErrors(this);return b[a]&&b[a].length>0},getError:function(a){return this.validation.getErrors(this)[a]||[]},getChangeables:function(){throw new Error("not implemented")},create:function(){return a({url:this.getBaseUri(),method:"POST",data:this.serialize()}).then(function(a){return this.uri=a.headers("location"),a}.bind(this))},read:function(){return a({url:this.uri,method:"GET"}).then(function(a){return this.deserialize(a.data),a}.bind(this))},update:function(){return a({url:this.uri,method:"PUT",data:this.serialize()})},"delete":function(){return a({url:this.uri,method:"DELETE"}).then(function(a){return this.uri=null,a}.bind(this))},search:function(){return a({url:this.getSearchUri(),method:"GET"}).then(function(a){var b=angular.fromJson(a.data);a.results=[];for(var c=0;c<b.length;c+=1)a.results.push(this.type.desimplify(b[c]));return a}.bind(this))},serialize:function(){return angular.toJson(this.simplify())},deserialize:function(a){this.desimplify(angular.fromJson(a))},simplify:function(){return{uri:this.uri}},desimplify:function(a){this.uri=a.uri},getBaseName:function(){throw new Error("not implemented")},getBaseUri:function(){throw new Error("not implemented")},getSearchUri:function(){return this.getBaseUri()+"?"+this.toSearchParameters()},toSearchParameters:function(){var a=[],c=b(this.simplify());for(var d in c){var e=c[d];if(null!=e){var f=encodeURIComponent(d)+"="+encodeURIComponent(e);a.push(f)}}return a.join("&")}},{deserialize:function(a){var b=new this;return b.deserialize(a),b},desimplify:function(a){var b=new this;return b.desimplify(a),b}})}]),angular.module("ch.maenulabs.rest.angular.router").provider("ch.maenulabs.rest.angular.router.router",["$routeProvider",function(a){var b="serialization",c=":"+b+"*",d={},e=function(a,b){return a+"/"+b},f=function(a,b){d[e(a,b)]="/"+a+"/"+b+"/"+c},g=function(a,b){return d[e(a,b)]};this.addRoute=function(c,d,e,h){h.resolve||(h.resolve={}),h.resolve.resource=["$route",d,function(a,c){var d=a.current.params[b];d||(d={});var e=c.deserialize(d);return e.uri?e.read().then(function(){return e}):e}],f(c,e),a.when(g(c,e),h)},this.$get=function(){return{getUri:function(a,b){return g(a.getBaseName(),b).replace(c,a.serialize())}}}}]);